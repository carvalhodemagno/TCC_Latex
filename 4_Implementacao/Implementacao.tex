%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Desenvolvimento e Implementação}
\label{chapter:desenvolvimento}
Este capítulo apresenta detalhadamente o que foi feito para desenvolver e implementar o sistema de gerenciamento e controle de um condicionador de ar, levando em conta 3 pilares principais: \textit{Hardware}, \textit{Firmware} e \textit{Software}.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{\textit{Hardware}}
\label{section_hardware}
O desenvolvimento do \textit{hardware} iniciou-se com o levantamento dos circuitos elétricos necessários para cumprir as funções requeridas conforme a concepção do projeto, sendo eles: \textbf{Circuito de Conexão com \textit{Wi-Fi}}, \textbf{Circuito de Ativação do Condicionador de Ar} e \textbf{Circuito de Sensoriamento}. O Circuito de Conexão com \textit{Wi-Fi} é  responsável por trocar informações com o aplicativo mobile, utilizando o protocolo MQTT. O Circuito de Ativação do Condicionador de Ar é responsável controlar alimentação elétrica entregue ao dispositivo. E o Circuito de Sensoriamento é responsável por realizar as medições provenientes da rede elétrica - como tensão, corrente, fator de potência, potência ativa e frequência - com intuito de definir se os níveis estão adequados para o perfeito funcionamento do condicionador de ar e verificar a presença ou ausência humana onde o equipamento está instalado.

O desenvolvimento deste pilar do projeto foi dividido em 2 partes principais: a escolha dos componentes a serem usados em cada circuito e o desenvolvimento dos esquemáticos elétricos e o layout da placa de circuito impresso (PCB).
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Componentes utilizados} 
Para realizar a escolha dos componentes foi levado em conta principalmente o custo, visando tornar o produto atrativo ao usuário final, ou seja, o consumidor.

Para suprir as funcionalidades do \textbf{Circuito de Conexão com \textit{Wi-Fi}}, o componente principal escolhido foi o módulo ESP12-F, representado na figura \ref{fig:ESP12-F}, que contém um microcontrolador juntamente com o circuito de radio-frequência (RF) para o \textit{Wi-Fi} e um LED indicativo. O microcontrolador contido no módulo é o ESP8266EX, representado na figura \ref{fig:ESP8266EX}, e suas principais características são\cite{ESP8266EX_DATASHEET}:

\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\columnwidth]{figuras/ESP12-F}
	\caption{Módulo ESP12-F\cite{AiThinker}.}
	\label{fig:ESP12-F}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\columnwidth]{figuras/ESP8266EX}
	\caption{Microcontrolador ESP8266EX \cite{ESP8266_MICRO}.}
	\label{fig:ESP8266EX}
\end{figure}

\begin{itemize}
	\item Microprocessador de 32 bits;
	\item \textit{Wi-Fi} integrado sob o protocolo 802.11 b/g/n, na frequência de 2.4GHz;
	\item Interface periféricas: UART, SDIO, SPI, I2C, I2S, GPIO, ADC e PWM;
	\item Tensão de operação: 2,5V a 3,6V;
	\item Corrente de operação: em média 80mA;
	\item Tamanho: 5 mm x 5 mm;
	\item 32 pinos;
	\item Interface de gravação tanto por UART, quanto por \textit{over-the-air} (OTA);
	\item Até 4 perfis de baixo consumo de energia.
\end{itemize}

Foram adicionados 2 (dois) \textit{light-emitting diodes} (LEDs) do tipo \textit{suface mounting device} (SMD), representado na figura \ref{fig:LED_SMD}, a este circuito também, um para indicar comunicação com o celular pelo protocolo MQTT e um para indicar se a alimentação elétrica da PCB está nos níveis corretos, assim como 2 (dois) botões do tipo \textit{push-buttom}, representado na figura \ref{fig:Push_Button}, para realizar a gravação do \textit{firmware} no microcontrolador.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.3\columnwidth]{figuras/LED_SMD}
	\caption{LED SMD \cite{LED_SMD}.}
	\label{fig:LED_SMD}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.3\columnwidth]{figuras/Push_Button}
	\caption{Botão do tipo \textit{push} \cite{Push_Button}.}
	\label{fig:Push_Button}
\end{figure}

Para o \textbf{Circuito de Ativação do Condicionador de Ar}, o principal componente escolhido foi o relé SRD-05VDC-SL-C, representado na figura \ref{fig:srd-05vdc-sl-c}, quais características principais são:

\begin{itemize}
	\item Tensão de ativação do enrolamento: 5 V;
	\item Corrente nominal do enrolamento: 89,3 mA;
	\item Resistência do enrolamento: 55 $ \Omega $;
	\item Consumo de potência do enrolamento: 0,36 W;
	\item Máxima tensão admissível no chave: 110 VDC ou 225 VAC;
	\item Capacidade de corrente da chave para carga do tipo resistiva: 10 A para 125 VAC e 7 A para 240 VAC.
\end{itemize}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.3\columnwidth]{figuras/srd-05vdc-sl-c}
	\caption{Relé SRD-05VDC-SL-C \cite{SRD-05VDC-SL-C_imagem}.}
	\label{fig:srd-05vdc-sl-c}
\end{figure}

O relé SRD-05VDC-SL-C foi utilizado para ativar uma contatora que, por sua vez, alimenta o condicionador de ar. Como o objetivo foi de ativar qualquer tipo de condicionador de ar, utilizou-se contatoras, representadas na imagem \ref{fig:contatora}, que aceitassem tanto 110 VAC quanto 220 VAC no enrolamento de alimentação.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\columnwidth]{figuras/contatora}
	\caption{Contatora Telemecanique \cite{contatora_ref}.}
	\label{fig:contatora}
\end{figure}

Para o \textbf{Circuito de Sensoriamento}, o componente escolhido para fazer as medições de tensão, corrente, fator de potência e frequência da rede de energia elétrica, informações essas suficientes para definir se ela está adequada para alimentar o condicionador de ar, foi MCP39F521, representado na figura \ref{fig:MCP39F521}. O MCP39F521 é um dispositivo de monitoramento de energia monofásico completo e altamente integrado, projetado para medição em tempo real de energia de entrada para fontes de alimentação de corrente alternada e de corrente contínua, unidades de distribuição de energia, consumidor e aplicações industriais. Inclui ADCs delta-sigma de canal duplo, um mecanismo de cálculo de 16 bits, EEPROM e uma interface I2C de dois fios flexível. Uma referência integrada de tensão de baixa derivação com 10 ppm/°C além de 94,5 dB de desempenho de sinal-ruído e taxa de distorção (SINAD) em cada canal de medição permite melhor que 0,1 $ \% $ de projetos precisos em uma faixa dinâmica de 4000:1\cite{MCP39F521_Datasheet}. Foi adicionado também um sensor de temperatura analógico, por questões de segurança (superaquecimento), para monitorar a temperatura da PCB, MCP9700 que é representado pela figura \ref{fig:MCP9700}.

Para realizar as medições de presença humana o componente utilizado foi o sensor EKMC1601111, ilustrado pela figura \ref{fig:EKMC1601111}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.3\columnwidth]{figuras/MCP39F521}
	\caption{Circuito Integrado (CI) MCP39F521 \cite{MCP39F521}.}
	\label{fig:MCP39F521}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.3\columnwidth]{figuras/MCP9700}
	\caption{Circuito Integrado MCP9700 \cite{MCP9700}.}
	\label{fig:MCP9700}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.3\columnwidth]{figuras/EKMC1601111}
	\caption{Sensor de presença EKMC1601111 \cite{EKMC1601111}.}
	\label{fig:EKMC1601111}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Esquemáticos elétricos e \textit{Layout} da PCB}
\label{subsection_esquematico}
A partir dos circuitos elétricos previamente citados, foi realizado um estudo nos documentos de \textit{Reference Design} e \textit{Datasheets} disponibilizados pelos fabricantes dos CI's utilizados, de modo a verificar todas as considerações para o correto funcionamento dos circuitos. O documento principal utilizado foi o guia do usuário para o MCP39F521 \cite{MCP39f521_user_guide}, que auxiliou principalmente no \textbf{Circuito de Sensoriamento}. Elaborou-se então os esquemáticos elétricos, ilustrados nas figuras \ref{fig:Schematic_Power_Supply}, \ref{fig:Schematic_Core_Processor} e \ref{fig:Schematic_Meter}.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\columnwidth]{figuras/Schematic_Power_Supply}
	\caption{Esquemático elétrico da alimentação do circuito.}
	\label{fig:Schematic_Power_Supply}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\columnwidth]{figuras/Schematic_Core_Processor}
	\caption{Esquemático elétrico referente ao microcontrolador.}
	\label{fig:Schematic_Core_Processor}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=1\columnwidth]{figuras/Schematic_Meter}
	\caption{Esquemático elétrico do sistema de medição da energia elétrica.}
	\label{fig:Schematic_Meter}
\end{figure}

A comunicação entre o microcontrolador e o circuito de medição de energia elétrica é realizada através de I2C, por meio dos sinais "SDA"\,e "SCL", já a interação realizada com o circuito de acionamento da contatora e o sensor de presença é por meio de escrita e leitura de GPIO's, respectivamente pelos sinais "RELAY\_GPIO"\,e "MOTION\_SENS".

O relé utilizado para acionamento da contatora é controlado com tensão de 5V DC, como a tensão usada para alimentar a placa é do tipo alternada, foi utilizado com conversor de tensão AC/DC, "U3"\,na figura \ref{fig:Schematic_Power_Supply}, capaz de aceitar padrões 110 e 220 como entrada, convertendo-a para tensão DC de 5V. Por outro lado, o microcontrolador, o medidor de energia e o sensor de presença são alimentados com tensão igual a 3.3V, portanto foi utilizado um regulador linear, "U4"\,na figura \ref{fig:Schematic_Power_Supply}, para regular a tensão de 5V para 3.3V.

A partir da finalização do desenvolvimento dos esquemáticos elétricos, é possível gerar a lista de todos os componentes, chamada de BOM (Bill Of Materials), representada pela tabela \ref{table:lista_material}, possibilitando a aquisição para futura prototipagem da PCB.

\begin{table}[H]
	\caption{Lista de materiais}	
	\label{table:lista_material}
	\begin{center}
		\begin{tabular}{|c|c|}
			\hline
		Componente & Quantidade \\ \hline
		Capacitor cerâmico SMD 0603 100nF & 10 \\ \hline
		Capacitor de alumínio polarizado SMD 10uF & 3 \\ \hline
		Capacitor cerâmico SMD 0603 33nF & 4 \\ \hline
		Capacitor cerâmico SMD 0603 10uF & 1 \\ \hline
		LED SMD 0603 Verde & 2 \\ \hline
		Diodo SMD LL4148 & 1 \\ \hline
		Fusível PTH & 1 \\ \hline
		Indutor SMD 0805  & 2 \\ \hline
		Terminal Block Verde PTH & 4 \\ \hline
		Terminal 4x1 & 1 \\ \hline
		Transistor SMD NPN & 1 \\ \hline
		Resistor SMD 0603 330R & 1 \\ \hline
		Varistor PTH & 1 \\ \hline
		Resistor SMD 0603 4K7 & 3 \\ \hline
		Resistor SMD 0603 6R & 1 \\ \hline
		Resistor SMD 0603 1K & 6 \\ \hline
		Resistor SMD 0603 2.49R & 1 \\ \hline
		Resistor SMD 2010 499K & 2 \\ \hline
		Resistor SMD 0603 100R & 1 \\ \hline
		Resistor SMD 0603 10K & 4 \\ \hline
		Resistor SMD 0603 2.1K & 2 \\ \hline
		Resistor SMD 0603 470R & 2 \\ \hline
		Resistor SMD 0603 33R & 1 \\ \hline
		Relé 5V PTH & 1 \\ \hline
		Chave tactíl do tipo push & 2 \\ \hline
		ESP-12F & 1 \\ \hline
		Optoisolador SMD & 1 \\ \hline
		Fonte AC/DC PTH 5V & 1 \\ \hline
		Regulador linerar SMD 3.3V & 1 \\ \hline
		MCP39F521 & 1 \\ \hline
		MCP9700T-E/TT & 1 \\ \hline
		EKMC1601111 & 1 \\ \hline
		
		\end{tabular}
	\end{center}
\end{table}

Em seguida a definição de todos os componentes a serem utilizados na PCB, e as ligações entre eles definidas nos esquemáticos, foi feito o desenho da PCB, representado pela figura \ref{fig:layout_pcb}, levando em conta novamente os documentos disponibilizados pelos fabricantes dos CIs utilizados, visando assim manter a integridade dos sinais. A ferramenta de desenvolvimento utilizada permitiu também obter uma prévia da vista 3D na perspectiva isométrica aproximada do real, retratada na figura \ref{fig:pcb_3d}.

\begin{figure}[H]
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[width=0.9\columnwidth]{figuras/Layout_Top}
		\caption{\textit{Top Layer} do \textit{layout} da PCB.}
		\label{fig:Layout_Top}
	\end{subfigure}%
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[width=0.9\columnwidth]{figuras/Layout_Bottom}
		\caption{\textit{Bottom Layer} do \textit{layout} da PCB.}
		\label{fig:Layout_Bottom}
	\end{subfigure}%
	\caption{Camadas \textit{Top} e \textit{Bottom} da PCB.}
	\label{fig:layout_pcb}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.65\columnwidth]{figuras/Layout_3D_Isometric}
	\caption{Visão isométrica da representação 3D do \textit{layout} da PCB.}
	\label{fig:pcb_3d}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{\textit{Firmware}}
\label{section_firmware}
Para elaboração inicial do \textit{firmware}, foi utilizado o módulo NodeMCU Lol1n, mostrado na figura \ref{fig:nodemcu_lol1n}, que contém um módulo ESP-12E e os circuitos de alimentação e gravação por interface USB já embutidos nele. Adotou-se esta metodologia, de utilizar um módulo com os circuitos prontos para uso, com intuito de diminuir o tempo de desenvolvimento e também para permitir a elaboração do \textit{firmware} antes da conclusão do desenvolvimento do \textit{hardware}, citado na seção \ref{section_hardware}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.35\columnwidth]{figuras/nodemcu_lol1n}
	\caption{Módulo NodeMCU Lol1n \cite{nodemcu_lolin}.}
	\label{fig:nodemcu_lol1n}
\end{figure}

A partir da descrição do sistema, foi possível elaborar um algoritmo da funcionamento do \textit{firmware}, representando na figura \ref{fig:Firmware_Block_Diagram}, capaz de englobar as funcionalidades previamente levantadas no capítulo \ref{chapter:arquitetura_requisitos}. Tal diagrama foi elaborado com o intuito de guiar e facilitar o desenvolvimento deste pilar do projeto, a partir dele também foi possível sedimentar o desenvolvimento do \textit{firmware} em três partes principais: Comunicação sob o protocolo MQTT por meio da interface Wi-Fi, \textit{Driver} de controle dos periféricos e Monitoramento dos sensores. \underline{VERIFICAR SE EU DEVO ESCREVER AS FUNCIONALIDADES NOVAMENTE AQUI.}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.42\columnwidth]{figuras/Firmware_Block_Diagram}
	\caption{Diagrama em blocos do algoritmo de funcionamento do \textit{firmware}.}
	\label{fig:Firmware_Block_Diagram}
\end{figure}


\subsection{Comunicação sob o protocolo MQTT por meio da interface Wi-Fi}
Conforme citado na seção \ref{section_hardware}, o ESP8266EX apresenta a interface Wi-Fi integrada ao CI, característica que facilita o desenvolvimento do \textit{firmware} para as funcionalidades básicas do Wi-Fi como: 
\begin{itemize}
	\item Conectar em uma rede Wi-Fi por meio do SSID e Senha;
	\item Obtenção de IP nesta rede local;
	\item Acesso à internet pela rede local;
	\item Trocar mensagens por meio de um \textit{socket} na camada TCP;
\end{itemize}

Essas funcionalidades são primordiais para o funcionamento do projeto, uma vez que para trocar mensagens com o aplicativo \textit{mobile} a placa deve conectar em uma rede Wi-Fi com acesso à internet. 

Conectada à uma rede com acesso à internet, a placa é capaz de comunicar-se com o \textit{broker} MQTT e trocar mensagens, a partir do tópico escolhido. Conforme a figura \ref{fig:Firmware_Block_Diagram}, após obter êxito na comunicação com o \textit{broker}, o microcontrolador realiza o \textit{subscribe} no tópico de recebimento de mensagens e espera por novas requisições.

Cada funcionalidade foi representada por um tipo de mensagem, conforme a tabela \ref{table:mqtt_mensagens}, para que o microcontrolador fosse capaz de interpretar, executar e responder às requisições provenientes do aplicativo mobile, conforme o fluxo representado pela figura \ref{fig:firmware_mensagem_placa_app}.

\begin{table}[h!]	
	\caption{Mensagens de requisições de funcionalidades}
	\label{table:mqtt_mensagens}
	\begin{center}
		\begin{tabular}{|c|C{7cm}|}
			\hline
			Mensagem & Funcionalidade \\ \hline
			"AC\_On" & Ligar condicionador de ar \\ \hline
			"AC\_Off" & Desligar condicionador de ar \\ \hline
			"Energy\_Info" & Verificar valores de energia elétrica \\ \hline
			"Presence\_Sensor" & Verificar presença humana\\ \hline
			"Set\_On;hh;mm" & Escolher horário para ligar (onde hh e mm representam a hora e o minuto respectivamente)\\ \hline
			"Set\_Off;hh;mm" & Escolher horário para desligar (onde hh e mm representam a hora e o minuto respectivamente)\\ \hline
		\end{tabular}
	\end{center}
\end{table}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.85\columnwidth]{figuras/firmware_mensagem_placa_app}
	\caption{Fluxo de requisição no ponto de vista do \textit{firmware}.}
	\label{fig:firmware_mensagem_placa_app}
\end{figure}

\subsection{\textit{Driver} de controle dos periféricos}
Para que ocorra o acionamento do condicionador de ar, leitura dos valores de energia elétrica e verificação da presença humana, o \textit{firmware} deve ser capaz de enviar, receber e interpretar informações dos componentes de \textit{hardware}, citados na seção \ref{section_hardware}, para isso é implementada uma camada, chamada de \textit{Driver}, responsável por fazer esse intermédio entre o microcontrolador e estes periféricos.

Para acionar o condicionador de ar, o \textit{Driver} controla uma GPIO (General Purpose Input Output). Para "ligar" o dispositivo a GPIO mantem-se em nível lógico baixo e para "desligar" o dispositivo a GPIO mentem-se em nível lógico alto. Esta lógica invertida é dada pelo uso de um transistor do tipo NPN no circuito de acionamento implementado, ilustrado na figura \ref{fig:Schematic_Power_Supply}.

Para obter os valores de energia elétrica - tensão alternada, corrente alternada, frequência da rede elétrica, potência ativa e fator de potência -, o \textit{Driver} comunica por interface I2C com o CI MCP39F521, figura \ref{fig:MCP39F521}. É então realizada uma requisição de um dos registrados do CI, onde as informações ficam armazenadas, que retorna um pacote de 35 \textit{bytes} como resposta. Para interpretar o pacote são usadas funções lógicas de AND e deslocamento de \textit{bits}.

Para verificar a presença humana, o \textit{Driver} realiza a leitura de uma GPIO conectada à saída do sensor de presença. Este sensor de presença mantém sua saída em nível lógico alto ao detectar seres humanos e mantém seu nível lógico baixo quando não detecta seres humanos.


\subsection{Monitoramento dos sensores}

Baseando-se na descrição do sistema retratada no capítulo \ref{chapter:arquitetura_requisitos}, foram elaborados 2 (dois) algorítimos para o monitoramento dos sensores. O primeiro referente ao sensor responsável pela leitura da energia elétrica e os níveis aceitáveis para o funcionamento correto do condicionador de ar e o segundo referente ao sensor de presença no local onde o condicionador de ar está instalado.

Em relação ao primeiro, o objetivo é garantir que os parâmetros de energia elétrica entregues ao condicionador de ar estejam suficientes para o perfeito funcionamento dele, considerando uma certa variação de 10\% dos valores de tensão alternada e frequência da rede elétrica, conforme citado no capítulo \ref{chapter:arquitetura_requisitos}. Portanto, para realizar esta proteção contra mal funcionamentos, foi desenvolvida uma rotina responsável por realizar leituras constantes no MCP39F521, desativando assim a alimentação do condicionador ao verificar algum parâmetro fora da variação aceita.

Em relação ao segundo, o objetivo é informar ao usuário caso haja consumo de energia no condicionador de ar com ausência de pessoas no cômodo em que o dispositivo está instalado, possibilitando assim a economia de energia caso o usuário tenha esquecido aquele ligado. Portanto, para realizar esta funcionalidade, foi desenvolvida uma rotina capaz de verificar constantemente a presença humana, realizando leituras no sensor de presença, representando na figura \ref{fig:EKMC1601111}.


\section{Aplicativo \textit{mobile}}
\label{section_software}
Para esta tarefa, foi realizada a análise da descrição do sistema, retratada no capítulo \ref{chapter:arquitetura_requisitos}, que permitiu levantar as funcionalidades a serem disponibilizadas ao usuário no aplicativo \textit{mobile}, sendo elas: ligar ou desligar o condicionador de ar, verificar o consumo de energia elétrica, verificar presença humana, escolher horário para ligar e para desligar o condicionador de ar.

O aplicativo foi desenvolvido em 2 frentes, primeiramente a parte que o usuário não vê, como comunicação com a internet, as regras de comunicação com o \textit{hardware} implementado e etc, e depois a parte que o usuário vê e
interage com, como os botões, caixas de texto e etc.

Ou seja, para esta aplicação, a primeira parte é responsável por comunicar com o \textit{broker} MQTT e trocar as mensagens com o hardware por meio do tópico escolhido, já a segunda parte é responsável pela interação do usuário com o sistema a partir da escolha da funcionalidade.

Respeitando o fluxograma representado pela figura, \ref{fig:firmware_mensagem_app_placa}, a comunicação por meio do protocolo MQTT foi desenvolvida, validando o funcionamento da comunicação com o \textit{hardware}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.85\columnwidth]{figuras/firmware_mensagem_app_placa}
	\caption{Fluxo de requisição no ponto de vista do aplicativo \textit{mobile}.}
	\label{fig:firmware_mensagem_app_placa}
\end{figure}

A partir disso, as funcionalidades citadas anteriormente foram desenvolvidas seguindo os tipos de mensagens previamente retratados na tabela \ref{table:mqtt_mensagens}, finalizando-se assim a primeira parte do aplicativo \textit{mobile}.

Para a segunda parte, foi inicialmente analisada a interatividade com o aplicativo a nível de usuário com botões sem ícones. Foi percebido então que a falta de ilustração das funcionalidades nos botões tornava o aplicativo não intuitivo, portanto foram escolhidos os ícones, retratados na figura \ref{fig:icones_app}, que mais se aproximassem na retratividade das funcionalidades descritas, além disso, para mostrar ao usuário o retorno das requisições realizadas foi utilizada uma caixa de texto.

\begin{figure}[H]
	\begin{subfigure}{1\textwidth}
		\centering
		\includegraphics[width=0.5\columnwidth]{figuras/on_off_icon}
		\caption{Ícone da função Liga/Desliga.}
		\label{fig:on_off_icon}
	\end{subfigure}%
	\\
	\begin{subfigure}{.475\textwidth}
		\centering
		\includegraphics[width=0.5\columnwidth]{figuras/energy_icon}
		\caption{Ícone da função para obter os níveis da energia elétrica no condicionador de ar.}
		\label{fig:energy_icon}
	\end{subfigure}
	\space\space\space\space\space\space
	\begin{subfigure}{.475\textwidth}
		\centering
		\includegraphics[width=0.62\columnwidth]{figuras/motion_detection_icon}
		\caption{Ícone da função da verificação de presença humana.}
		\label{fig:motion_detection_icon}
	\end{subfigure}%
	\\
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=0.5\columnwidth]{figuras/time_picker_on_icon}
		\caption{Ícone da função de temporizador para ligar.}
		\label{fig:time_picker_on_icon}
	\end{subfigure}
	\begin{subfigure}{.5\textwidth}
		\centering
		\includegraphics[width=0.5\columnwidth]{figuras/time_picker_off_icon}
		\caption{Ícone da função de temporizador para desligar.}
		\label{fig:time_picker_off_icon}
	\end{subfigure}
	\caption{Ícones do aplicativo \textit{mobile}.}
	\label{fig:icones_app}
\end{figure}
